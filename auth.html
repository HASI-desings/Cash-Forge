<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CashForge | Secure Access</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700;800&display=swap" rel="stylesheet">
    
    <!-- GLOBAL STYLES -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- ICONS -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- SUPABASE (Required for Auth) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* Auth Specific Overrides */
        body {
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; /* Prevent scrolling on auth screen */
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.1);
            width: 100%; max-width: 400px;
            border-radius: 32px; padding: 32px;
            position: relative; overflow: hidden;
            transition: height 0.4s var(--ease-smooth);
        }
    </style>
</head>
<body>

    <div class="bg-dots"></div>
    <!-- Floating Orbs -->
    <div class="blob blob-1" style="top: -10%; left: -10%;"></div>
    <div class="blob blob-2" style="bottom: -10%; right: -10%;"></div>

    <!-- MAIN CARD -->
    <main class="glass-card" id="main-card">
        
        <!-- LOGO HEADER -->
        <div class="text-center mb-6">
            <!-- Circular Logo Container -->
            <div class="relative w-24 h-24 mx-auto mb-4">
                <div class="absolute inset-0 bg-cyan-400/30 blur-2xl rounded-full animate-pulse-glow"></div>
                <div class="w-full h-full rounded-full overflow-hidden bg-white/20 backdrop-blur-sm shadow-xl flex items-center justify-center border border-white/40">
                    <!-- Correctly closed image tag -->
                    <img src="assets/images/logo.png" 
                         alt="CashForge" 
                         class="w-full h-full object-cover transform scale-110"
                         onerror="this.style.display='none'; this.parentElement.innerHTML = '<div class=\'w-full h-full flex items-center justify-center bg-cyan-100 text-cyan-800 font-bold text-3xl\'>CF</div>'">
                </div>
            </div>
            
            <h1 class="heading-font text-2xl font-bold text-slate-800" id="auth-title">Welcome Back</h1>
            <p class="text-sm text-slate-500 mt-1" id="auth-subtitle">Secure access to your portfolio</p>
        </div>

        <!-- Sliding Container -->
        <div class="overflow-hidden">
            <div class="form-slider" id="slider">
                
                <!-- LOGIN FORM -->
                <div class="form-view" id="login-view">
                    <form id="login-form">
                        <div class="input-group">
                            <input type="email" id="login-email" class="input-glass" placeholder="Email Address" required>
                            <i class="ph-bold ph-envelope-simple input-icon"></i>
                        </div>
                        <div class="input-group">
                            <input type="password" id="login-pass" class="input-glass" placeholder="Password" required>
                            <i class="ph-bold ph-lock-key input-icon"></i>
                            <i class="ph-bold ph-eye toggle-password" onclick="window.togglePass('login-pass', this)"></i>
                        </div>
                        
                        <div class="flex justify-end mb-6">
                            <a href="#" class="text-xs font-bold text-cyan-600 hover:text-cyan-700">Forgot Password?</a>
                        </div>

                        <button type="submit" class="btn-primary" id="login-btn">
                            <span>Sign In</span> <i class="ph-bold ph-arrow-right"></i>
                        </button>
                    </form>

                    <div class="text-center mt-6">
                        <p class="text-sm text-slate-500">Don't have an account? <button type="button" onclick="window.switchMode('register')" class="text-cyan-600 font-bold hover:underline">Create one</button></p>
                    </div>
                </div>

                <!-- REGISTER FORM -->
                <div class="form-view inactive" id="register-view">
                    <form id="register-form">
                        <div class="input-group">
                            <input type="text" id="reg-name" class="input-glass" placeholder="Full Name" required>
                            <i class="ph-bold ph-user input-icon"></i>
                        </div>
                        <div class="input-group">
                            <input type="email" id="reg-email" class="input-glass" placeholder="Email Address" required>
                            <i class="ph-bold ph-envelope-simple input-icon"></i>
                        </div>
                        <div class="input-group mb-2">
                            <input type="password" id="reg-pass" class="input-glass" placeholder="Create Password" required oninput="window.checkStrength(this.value)">
                            <i class="ph-bold ph-lock-key input-icon"></i>
                            <i class="ph-bold ph-eye toggle-password" onclick="window.togglePass('reg-pass', this)"></i>
                        </div>
                        
                        <!-- Strength Indicators -->
                        <div class="flex gap-1 mb-6 pl-2">
                            <div class="strength-dot" id="dot-1"></div>
                            <div class="strength-dot" id="dot-2"></div>
                            <div class="strength-dot" id="dot-3"></div>
                            <span class="text-[10px] text-slate-400 ml-2" id="strength-text">Min 8 chars</span>
                        </div>

                        <button type="submit" class="btn-primary" id="reg-btn">
                            <span>Create Account</span> <i class="ph-bold ph-user-plus"></i>
                        </button>
                    </form>

                    <div class="text-center mt-6">
                        <p class="text-sm text-slate-500">Already have an account? <button type="button" onclick="window.switchMode('login')" class="text-cyan-600 font-bold hover:underline">Sign In</button></p>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast"></div>

    <!-- UI LOGIC & AUTH INTEGRATION -->
    <script type="module">
        // Import Authentication Logic
        import { Auth } from './assets/js/auth.js';
        
        // --- UI FUNCTIONS (Attached to Window for HTML access) ---
        
        window.switchMode = (mode) => {
            const slider = document.getElementById('slider');
            const loginView = document.getElementById('login-view');
            const regView = document.getElementById('register-view');
            const title = document.getElementById('auth-title');
            const subtitle = document.getElementById('auth-subtitle');

            if (mode === 'register') {
                slider.style.transform = 'translateX(-50%)';
                loginView.classList.add('inactive');
                regView.classList.remove('inactive');
                title.innerText = "Join CashForge";
                subtitle.innerText = "Start your financial journey";
            } else {
                slider.style.transform = 'translateX(0)';
                loginView.classList.remove('inactive');
                regView.classList.add('inactive');
                title.innerText = "Welcome Back";
                subtitle.innerText = "Secure access to your portfolio";
            }
        };

        window.togglePass = (id, icon) => {
            const input = document.getElementById(id);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace('ph-eye', 'ph-eye-slash');
            } else {
                input.type = "password";
                icon.classList.replace('ph-eye-slash', 'ph-eye');
            }
        };

        window.checkStrength = (pass) => {
            const dot1 = document.getElementById('dot-1');
            const dot2 = document.getElementById('dot-2');
            const dot3 = document.getElementById('dot-3');
            const text = document.getElementById('strength-text');

            let score = 0;
            if (pass.length >= 8) score++;
            if (/\d/.test(pass)) score++;
            if (/[!@#$%^&*]/.test(pass)) score++;

            // Reset
            [dot1, dot2, dot3].forEach(d => { d.className = 'strength-dot'; });
            
            if (score >= 1) { dot1.classList.add('active', 'bg-red-400'); text.innerText = "Weak"; }
            if (score >= 2) { dot2.classList.add('active', 'bg-yellow-400'); dot1.classList.add('active', 'bg-yellow-400'); text.innerText = "Good"; }
            if (score === 3) { 
                dot3.classList.add('active', 'bg-green-400'); 
                dot1.className = 'strength-dot active bg-green-400';
                dot2.className = 'strength-dot active bg-green-400';
                text.innerText = "Strong"; 
            }
        };

        // --- AUTHENTICATION HANDLERS ---

        // 1. LOGIN
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('login-btn');
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;

            startLoading(btn, "Authenticating...");

            const response = await Auth.signIn(email, pass);

            if (response.success) {
                showToast("Login Successful!", "success");
                // Redirect logic
                setTimeout(() => window.location.href = 'home.html', 1000);
            } else {
                stopLoading(btn, "Sign In", "ph-arrow-right");
                showToast(response.message, "error");
                shakeCard();
            }
        });

        // 2. REGISTER
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('reg-btn');
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;

            // Validation
            if (pass.length < 8) {
                showToast("Password must be at least 8 characters", "error");
                shakeCard();
                return;
            }

            startLoading(btn, "Creating Account...");
            
            const response = await Auth.signUp(email, pass, name);

            if (response.success) {
                if (response.requiresVerification) {
                    // Email Verification Required Flow
                    showToast("Verification Email Sent! Check Inbox.", "success");
                    btn.innerHTML = `<i class="ph-bold ph-check"></i> Check Email`;
                    btn.classList.remove('btn-loading');
                    // Don't switch immediately so user sees the message
                } else {
                    // Instant Success Flow
                    showToast("Account Created!", "success");
                    stopLoading(btn, "Create Account", "ph-user-plus");
                    window.switchMode('login');
                }
            } else {
                stopLoading(btn, "Create Account", "ph-user-plus");
                showToast(response.message, "error");
                shakeCard();
            }
        });

        // --- UTILS ---
        function startLoading(btn, text) {
            btn.classList.add('btn-loading');
            btn.innerHTML = `<div class="loader-spinner w-5 h-5 border-white"></div> <span>${text}</span>`;
        }

        function stopLoading(btn, text, icon) {
            btn.classList.remove('btn-loading');
            btn.innerHTML = `<span>${text}</span> <i class="ph-bold ${icon}"></i>`;
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            const color = type === 'success' ? 'success' : 'error';
            const icon = type === 'success' ? 'ph-check-circle' : 'ph-warning-circle';
            toast.className = `toast active ${color}`;
            toast.innerHTML = `<i class="ph-fill ${icon} text-lg"></i> ${msg}`;
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        function shakeCard() {
            const card = document.getElementById('main-card');
            card.classList.add('animate-shake');
            setTimeout(() => card.classList.remove('animate-shake'), 500);
        }
    </script>
</body>
</html>