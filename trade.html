<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CashForge | Pro Trading</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- GLOBAL STYLES -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- ICONS -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- FIXED ANIMATIONS --- */
        /* Forces content to become visible */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0; /* Starts hidden */
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1; /* Ends visible */
                transform: translateY(0);
            }
        }

        /* Trade Specific Styles */
        .trade-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .trade-card:active { transform: scale(0.98); }

        /* Countdown Circle */
        .countdown-container {
            position: relative; width: 220px; height: 220px; margin: 0 auto;
            display: flex; align-items: center; justify-content: center;
        }
        .pulse-ring {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            border: 2px solid rgba(0,255,255,0.3);
            animation: pulse-slow 3s infinite;
        }
        
        /* Input Focus State */
        .trade-input-box {
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.8);
        }
        .trade-input-box:focus-within {
            border-color: #00FFFF;
            background: rgba(255,255,255,0.9);
            box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.2);
        }
        .trade-input-box.error {
            border-color: #ef4444;
            background: rgba(254, 242, 242, 0.8);
            animation: shake 0.4s ease-in-out;
        }

        @keyframes pulse-slow {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.1; }
            100% { transform: scale(1); opacity: 0.5; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>

    <div class="bg-dots"></div>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- HEADER -->
    <header class="gradient-bar fixed top-0 w-full z-50 h-[70px] flex items-center justify-between px-5 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 flex items-center justify-center rounded-xl bg-gradient-to-br from-cyan-300 to-cyan-500 shadow-lg shadow-cyan-200/50">
                <i class="ph-bold ph-lightning text-white text-xl"></i>
            </div>
            <div>
                <span class="heading-font font-bold text-xl tracking-tight text-slate-800 leading-none block">CashForge</span>
            </div>
        </div>
        <div class="glass-panel px-4 py-1.5 rounded-full flex items-center gap-2 border border-cyan-100 shadow-sm">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <!-- Initial state is loading/zero -->
            <span class="heading-font font-bold text-slate-800" id="header-balance">...</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="w-full max-w-lg mx-auto px-4 relative z-10 pt-4">
        
        <!-- PAGE HEADER -->
        <div class="mb-6 flex items-end justify-between">
            <div>
                <h2 class="heading-font text-2xl font-bold text-slate-800">Pro Trading</h2>
                <p class="text-xs text-slate-500">Secure market. One active trade limit.</p>
            </div>
        </div>

        <!-- === VIEW 1: MARKET LIST (Available Trades) === -->
        <!-- Fixed Class: fade-in-up ensures visibility -->
        <div id="view-market" class="space-y-5 fade-in-up">
            <!-- Tiers injected via JS -->
        </div>

        <!-- === VIEW 2: ACTIVE DASHBOARD (Hidden by Default) === -->
        <div id="view-active" class="hidden fade-in-up text-center pt-4">
            
            <div class="glass-panel rounded-3xl p-6 mb-6 relative overflow-hidden border-t-4 border-cyan-400">
                <h3 class="heading-font text-lg font-bold text-slate-600 mb-6 uppercase tracking-wider">Trading in Progress</h3>
                
                <!-- Countdown Visual -->
                <div class="countdown-container mb-6">
                    <div class="pulse-ring"></div>
                    <div class="w-48 h-48 rounded-full bg-gradient-to-tr from-slate-50 to-white shadow-inner flex flex-col items-center justify-center border border-slate-100 z-10">
                        <span class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-1">Time Remaining</span>
                        <span id="timer-display" class="font-mono text-3xl font-bold text-slate-800 tracking-tighter">00:00:00</span>
                        <div class="mt-2 flex items-center gap-1 text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full border border-green-200">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Live Market
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/50 p-3 rounded-2xl border border-white shadow-sm">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Invested</div>
                        <div class="text-lg font-bold text-slate-800" id="active-invested">--</div>
                    </div>
                    <div class="bg-white/50 p-3 rounded-2xl border border-white shadow-sm">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Estimated Return</div>
                        <div class="text-lg font-bold text-brand-dark" id="active-return">--</div>
                    </div>
                </div>
            </div>

            <p class="text-xs text-slate-400 max-w-[200px] mx-auto leading-relaxed">
                <i class="ph-fill ph-info"></i> Funds are locked in the smart contract until the trading cycle completes.
            </p>
        </div>

    </main>

    <!-- TOAST CONTAINER -->
    <div id="toast" class="toast"></div>

    <!-- NAVIGATION BAR -->
    <nav class="gradient-bar fixed bottom-0 w-full z-50 h-[80px] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
        <div class="flex justify-around items-end h-full max-w-lg mx-auto pb-4">
            <a href="home.html" class="nav-item flex flex-col items-center group w-16">
                <div class="nav-icon-box"><i class="ph-bold ph-house nav-icon"></i></div><span class="nav-text">Home</span>
            </a>
            <a href="tasks.html" class="nav-item flex flex-col items-center group w-16">
                <div class="nav-icon-box"><i class="ph-bold ph-list-checks nav-icon"></i></div><span class="nav-text">Tasks</span>
            </a>
            <!-- TRADE (Active) -->
            <a href="trade.html" class="nav-item active flex flex-col items-center group w-16">
                <div class="nav-icon-box"><i class="ph-bold ph-chart-line-up nav-icon"></i></div><span class="nav-text">Trade</span>
            </a>
            <a href="teams.html" class="nav-item flex flex-col items-center group w-16">
                <div class="nav-icon-box"><i class="ph-bold ph-users-three nav-icon"></i></div><span class="nav-text">Team</span>
            </a>
            <a href="profile.html" class="nav-item flex flex-col items-center group w-16">
                <div class="nav-icon-box"><i class="ph-bold ph-user-circle nav-icon"></i></div><span class="nav-text">Profile</span>
            </a>
        </div>
    </nav>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- 1. MOCK CONFIGURATION ---
        const TIERS = [
            { id: 'daily', name: 'Day Trading', durationHours: 24, percent: 3, min: 3000, max: 80000 },
            { id: 'weekly', name: 'Weekly Booster', durationHours: 168, percent: 25, min: 15000, max: 250000 },
            { id: 'monthly', name: 'Monthly Mega', durationHours: 720, percent: 350, min: 250000, max: 1000000 }
        ];

        let state = {
            balance: 0,
            activeTrade: null // { tierId, amount, startTime, endTime }
        };

        const formatCurrency = (val) => '₨ ' + val.toLocaleString();

        // --- 2. RENDER MARKET VIEW ---
        function renderMarket() {
            const container = document.getElementById('view-market');
            container.innerHTML = '';

            TIERS.forEach(tier => {
                // Generate unique HTML for each card
                const html = `
                    <div class="trade-card rounded-2xl p-5 group">
                        <!-- Card Header -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="bg-cyan-50 text-brand-dark text-[10px] font-bold px-2 py-1 rounded border border-cyan-100 uppercase tracking-wide">
                                    <i class="ph-bold ph-clock"></i> ${tier.durationHours} Hours
                                </span>
                                <h3 class="heading-font font-bold text-xl text-slate-800 mt-2">${tier.name}</h3>
                                <p class="text-[10px] text-slate-500 font-medium mt-1">
                                    Limit: ${formatCurrency(tier.min)} - ${formatCurrency(tier.max)}
                                </p>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold text-brand-dark tracking-tight">+${tier.percent}%</div>
                                <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Return</div>
                            </div>
                        </div>

                        <!-- Smart Input Area -->
                        <div class="mb-2">
                            <div id="box-${tier.id}" class="trade-input-box bg-white/40 p-1 rounded-xl flex items-center gap-2">
                                <div class="pl-3 text-slate-400 text-sm font-bold">₨</div>
                                <input type="number" id="input-${tier.id}" 
                                    oninput="calculateProfit('${tier.id}', ${tier.percent}, ${tier.min}, ${tier.max})"
                                    placeholder="Enter Amount" 
                                    class="bg-transparent border-none outline-none w-full text-sm font-bold text-slate-700 placeholder-slate-400 h-10">
                                <button onclick="setMax('${tier.id}', ${tier.max}, ${tier.percent}, ${tier.min})" 
                                    class="text-[10px] font-bold text-brand-dark bg-cyan-50 px-3 py-1.5 rounded-lg mr-1 hover:bg-cyan-100 transition active:scale-95">
                                    MAX
                                </button>
                            </div>
                            
                            <!-- Live Feedback Area -->
                            <div id="feedback-${tier.id}" class="h-6 mt-1.5 text-[11px] font-bold pl-1 flex items-center"></div>
                        </div>

                        <button onclick="startTrade('${tier.id}')" 
                            class="w-full mt-2 py-3.5 rounded-xl bg-slate-800 text-white font-bold text-sm shadow-lg hover:bg-slate-700 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                            Start Investment <i class="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                `;
                // Append string as HTML
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- 3. LOGIC: CALCULATOR & VALIDATION ---
        function calculateProfit(id, percent, min, max) {
            const input = document.getElementById(`input-${id}`);
            const feedback = document.getElementById(`feedback-${id}`);
            const box = document.getElementById(`box-${id}`);
            const val = parseFloat(input.value);

            // Reset Styles
            box.classList.remove('error');

            // Clear if empty
            if (!val || isNaN(val)) {
                feedback.innerHTML = '';
                return;
            }

            // 1. Validation Logic
            if (val < min) {
                feedback.innerHTML = `<span class="text-red-500 flex items-center gap-1"><i class="ph-fill ph-warning-circle"></i> Min: ${formatCurrency(min)}</span>`;
                box.classList.add('error');
                return;
            }
            if (val > max) {
                feedback.innerHTML = `<span class="text-red-500 flex items-center gap-1"><i class="ph-fill ph-warning-circle"></i> Max: ${formatCurrency(max)}</span>`;
                box.classList.add('error');
                return;
            }
            if (val > state.balance) {
                feedback.innerHTML = `<span class="text-red-500 flex items-center gap-1"><i class="ph-fill ph-wallet"></i> Insufficient Balance</span>`;
                box.classList.add('error');
                return;
            }

            // 2. Profit Logic (Show Green)
            const profit = val * (percent / 100);
            const total = val + profit;
            
            feedback.innerHTML = `
                <span class="text-slate-400 mr-1">Exp. Return:</span>
                <span class="text-slate-800">${formatCurrency(total)}</span>
                <span class="text-green-600 ml-1 bg-green-50 px-1 rounded">(+${formatCurrency(profit)})</span>
            `;
        }

        function setMax(id, max, percent, min) {
            const amount = Math.min(state.balance, max);
            const input = document.getElementById(`input-${id}`);
            input.value = amount;
            calculateProfit(id, percent, min, max);
        }

        // --- 4. LOGIC: START TRADE ---
        function startTrade(tierId) {
            const tier = TIERS.find(t => t.id === tierId);
            const input = document.getElementById(`input-${tierId}`);
            const amount = parseInt(input.value);

            // Double Check
            if (!amount || amount < tier.min || amount > tier.max || amount > state.balance) {
                showToast("Please enter a valid amount within limits.", 'error');
                const box = document.getElementById(`box-${tierId}`);
                box.classList.add('error');
                setTimeout(() => box.classList.remove('error'), 500);
                return;
            }

            // Execute
            state.balance -= amount;
            
            // REAL DURATION: Hours * 60 * 60 * 1000
            const durationMs = tier.durationHours * 60 * 60 * 1000;
            const now = Date.now();
            
            state.activeTrade = {
                tierId: tierId,
                amount: amount,
                startTime: now,
                endTime: now + durationMs
            };

            updateUI();
            showToast("Trade Started Successfully!", "success");
            startTimer();
        }

        // --- 5. LOGIC: UI SWITCHING & TIMER ---
        function updateUI() {
            document.getElementById('header-balance').innerText = formatCurrency(state.balance);

            if (state.activeTrade) {
                document.getElementById('view-market').classList.add('hidden');
                document.getElementById('view-active').classList.remove('hidden');
                
                // Set Stats
                const tier = TIERS.find(t => t.id === state.activeTrade.tierId);
                const projected = state.activeTrade.amount * (1 + (tier.percent / 100));
                
                document.getElementById('active-invested').innerText = formatCurrency(state.activeTrade.amount);
                document.getElementById('active-return').innerText = formatCurrency(projected);
            } else {
                document.getElementById('view-market').classList.remove('hidden');
                document.getElementById('view-active').classList.add('hidden');
            }
        }

        function startTimer() {
            const display = document.getElementById('timer-display');
            
            const interval = setInterval(() => {
                if (!state.activeTrade) { clearInterval(interval); return; }

                const now = Date.now();
                const diff = state.activeTrade.endTime - now;

                if (diff <= 0) {
                    clearInterval(interval);
                    completeTrade();
                    return;
                }

                // Format Time (HH:MM:SS)
                const hours = Math.floor((diff / (1000 * 60 * 60))); 
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const seconds = Math.floor((diff / 1000) % 60);
                
                display.innerText = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function completeTrade() {
            const tier = TIERS.find(t => t.id === state.activeTrade.tierId);
            const profit = state.activeTrade.amount * (1 + (tier.percent / 100));
            
            state.balance += profit;
            state.activeTrade = null;
            
            updateUI();
            showToast(`Trade Finished! You earned ${formatCurrency(profit)}`, 'success');
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            const color = type === 'success' ? 'success' : 'error';
            const icon = type === 'success' ? 'ph-check-circle' : 'ph-warning-circle';
            
            toast.className = `toast active ${color}`;
            toast.innerHTML = `<i class="ph-fill ${icon} text-lg"></i> ${msg}`;
            
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // INIT
        // Delay slightly to let CSS load
        setTimeout(() => {
            renderMarket();
            document.getElementById('header-balance').innerText = formatCurrency(state.balance);
        }, 100);

    </script>
</body>
</html>