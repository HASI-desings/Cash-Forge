<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CashForge | Pro Trading</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- GLOBAL STYLES -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- ICONS -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- FIXED ANIMATIONS --- */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0; transform: translateY(20px);
        }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Trade Card */
        .trade-card {
            background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }
        .trade-card:active { transform: scale(0.98); }

        /* Input */
        .trade-input-box {
            transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.8);
        }
        .trade-input-box:focus-within {
            border-color: #00FFFF; background: rgba(255,255,255,0.9);
            box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.2);
        }
        .trade-input-box.error {
            border-color: #ef4444; background: rgba(254, 242, 242, 0.8);
            animation: shake 0.4s ease-in-out;
        }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Countdown Circle */
        .countdown-container { position: relative; width: 220px; height: 220px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        .pulse-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid rgba(0,255,255,0.3); animation: pulse-slow 3s infinite; }
        @keyframes pulse-slow { 0% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.1; } 100% { transform: scale(1); opacity: 0.5; } }
    </style>
</head>
<body>

    <div class="bg-dots"></div>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- HEADER -->
    <header class="gradient-bar fixed top-0 w-full z-50 h-[70px] flex items-center justify-between px-5 shadow-sm">
        <div class="flex items-center gap-3">
            <!-- Circular Logo Container -->
            <div class="w-10 h-10 relative">
                <div class="absolute inset-0 bg-cyan-400/30 blur-lg rounded-full animate-pulse-glow"></div>
                <!-- Embedded SVG Logo (Updated Circular Version) -->
                <svg class="w-full h-full relative z-10 drop-shadow-md" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="gradSmall" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00FFFF;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#008b8b;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="256" cy="256" r="240" fill="white" stroke="url(#gradSmall)" stroke-width="20"/>
                    <g transform="translate(106, 106) scale(0.6)">
                        <path d="M150 50 A 150 150 0 1 0 150 450 L 150 350 A 50 50 0 1 1 150 150 Z" fill="url(#gradSmall)" />
                        <rect x="180" y="50" width="80" height="400" rx="20" fill="url(#gradSmall)" />
                        <rect x="280" y="50" width="180" height="80" rx="20" fill="url(#gradSmall)" />
                        <rect x="280" y="210" width="120" height="80" rx="20" fill="url(#gradSmall)" />
                        <path d="M180 50 L 220 -50 L 260 50 Z" fill="#00FFFF" />
                    </g>
                </svg>
            </div>
            <div>
                <span class="heading-font font-bold text-xl tracking-tight text-slate-800 leading-none block">CashForge</span>
            </div>
        </div>
        <div class="glass-panel px-4 py-1.5 rounded-full flex items-center gap-2 border border-cyan-100 shadow-sm">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="heading-font font-bold text-slate-800" id="header-balance">...</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="w-full max-w-lg mx-auto px-4 relative z-10 pt-4 pb-24">
        
        <div class="mb-6 flex items-end justify-between">
            <div>
                <h2 class="heading-font text-2xl font-bold text-slate-800">Pro Trading</h2>
                <p class="text-xs text-slate-500">Secure market. One active trade limit.</p>
            </div>
        </div>

        <!-- === VIEW 1: MARKET LIST === -->
        <div id="view-market" class="space-y-5 fade-in-up">
            <!-- Tiers Injected via JS -->
        </div>

        <!-- === VIEW 2: ACTIVE DASHBOARD === -->
        <div id="view-active" class="hidden fade-in-up text-center pt-4">
            <div class="glass-panel rounded-3xl p-6 mb-6 relative overflow-hidden border-t-4 border-cyan-400">
                <h3 class="heading-font text-lg font-bold text-slate-600 mb-6 uppercase tracking-wider">Trading in Progress</h3>
                
                <div class="countdown-container mb-6">
                    <div class="pulse-ring"></div>
                    <div class="w-48 h-48 rounded-full bg-gradient-to-tr from-slate-50 to-white shadow-inner flex flex-col items-center justify-center border border-slate-100 z-10">
                        <span class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-1">Time Remaining</span>
                        <span id="timer-display" class="font-mono text-2xl font-bold text-slate-800 tracking-tighter">00d 00h 00m</span>
                        <div class="mt-2 flex items-center gap-1 text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full border border-green-200">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Live Market
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/50 p-3 rounded-2xl border border-white shadow-sm">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Invested</div>
                        <div class="text-lg font-bold text-slate-800" id="active-invested">--</div>
                    </div>
                    <div class="bg-white/50 p-3 rounded-2xl border border-white shadow-sm">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Total Return</div>
                        <div class="text-lg font-bold text-brand-dark" id="active-return">--</div>
                    </div>
                </div>
            </div>
            <p class="text-xs text-slate-400 max-w-[200px] mx-auto leading-relaxed"><i class="ph-fill ph-info"></i> Funds are locked until the cycle ends.</p>
        </div>

    </main>

    <!-- TOAST -->
    <div id="toast" class="toast"></div>

    <!-- NAVIGATION BAR -->
    <nav class="gradient-bar fixed bottom-0 w-full z-50 h-[80px] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
        <div class="flex justify-around items-end h-full max-w-lg mx-auto pb-4">
            <a href="home.html" class="nav-item flex flex-col items-center group w-16"><div class="nav-icon-box"><i class="ph-bold ph-house nav-icon"></i></div><span class="nav-text">Home</span></a>
            <a href="tasks.html" class="nav-item flex flex-col items-center group w-16"><div class="nav-icon-box"><i class="ph-bold ph-list-checks nav-icon"></i></div><span class="nav-text">Tasks</span></a>
            <a href="trade.html" class="nav-item active flex flex-col items-center group w-16"><div class="nav-icon-box"><i class="ph-bold ph-chart-line-up nav-icon"></i></div><span class="nav-text">Trade</span></a>
            <a href="teams.html" class="nav-item flex flex-col items-center group w-16"><div class="nav-icon-box"><i class="ph-bold ph-users-three nav-icon"></i></div><span class="nav-text">Team</span></a>
            <a href="profile.html" class="nav-item flex flex-col items-center group w-16"><div class="nav-icon-box"><i class="ph-bold ph-user-circle nav-icon"></i></div><span class="nav-text">Profile</span></a>
        </div>
    </nav>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- 1. CONFIGURATION ---
        const TIERS = [
            { id: 'weekly', name: 'Weekly Booster', days: 7, dailyPercent: 1.5, min: 3000, max: 50000 },
            { id: 'turbo', name: 'Ten-Day Turbo', days: 10, dailyPercent: 1.7, min: 5000, max: 100000 },
            { id: 'mega', name: 'Monthly Mega', days: 35, dailyPercent: 1.9, min: 15000, max: 300000 },
            { id: 'quant', name: 'Quarterly Quant', days: 120, dailyPercent: 3.0, min: 100000, max: 1000000 },
            { id: 'bull', name: 'Biannual Bull', days: 200, dailyPercent: 5.0, min: 150000, max: 2000000 }
        ];

        let state = {
            balance: 0, // Fetched from DB
            activeTrade: null 
        };

        const formatCurrency = (val) => '₨ ' + val.toLocaleString(undefined, {maximumFractionDigits: 0});

        // --- 2. INITIALIZATION ---
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('header-balance').innerText = formatCurrency(state.balance);
                renderMarket();
            }, 100);
        };

        // --- 3. RENDER MARKET ---
        function renderMarket() {
            const container = document.getElementById('view-market');
            container.innerHTML = '';

            TIERS.forEach(tier => {
                const html = `
                    <div class="trade-card rounded-2xl p-5 group">
                        <!-- Header -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="bg-cyan-50 text-brand-dark text-[10px] font-bold px-2 py-1 rounded border border-cyan-100 uppercase tracking-wide">
                                    <i class="ph-bold ph-clock"></i> ${tier.days} Days Lock
                                </span>
                                <h3 class="heading-font font-bold text-xl text-slate-800 mt-2">${tier.name}</h3>
                                <p class="text-[10px] text-slate-500 font-medium mt-1">
                                    Limit: ${formatCurrency(tier.min)} - ${formatCurrency(tier.max)}
                                </p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-brand-dark tracking-tight">${tier.dailyPercent}% / Day</div>
                                <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Daily Profit</div>
                            </div>
                        </div>

                        <!-- Input & Calc -->
                        <div class="mb-2">
                            <div id="box-${tier.id}" class="trade-input-box bg-white/40 p-1 rounded-xl flex items-center gap-2">
                                <div class="pl-3 text-slate-400 text-sm font-bold">₨</div>
                                <input type="number" id="input-${tier.id}" 
                                    oninput="calculateProfit('${tier.id}', ${tier.dailyPercent}, ${tier.days}, ${tier.min}, ${tier.max})"
                                    placeholder="Enter Amount" 
                                    class="bg-transparent border-none outline-none w-full text-sm font-bold text-slate-700 placeholder-slate-400 h-10">
                                <button onclick="setMax('${tier.id}', ${tier.max}, ${tier.dailyPercent}, ${tier.days}, ${tier.min})" 
                                    class="text-[10px] font-bold text-brand-dark bg-cyan-50 px-3 py-1.5 rounded-lg mr-1 hover:bg-cyan-100 transition active:scale-95">
                                    MAX
                                </button>
                            </div>
                            <!-- Live Feedback & Error Area -->
                            <div class="mt-1.5 pl-1">
                                <div id="feedback-${tier.id}" class="h-auto min-h-[20px] text-[11px] font-bold leading-snug"></div>
                                <div id="error-${tier.id}" class="h-auto min-h-[0px] text-[10px] font-bold text-red-500 flex items-center gap-1 transition-all"></div>
                            </div>
                        </div>

                        <button onclick="startTrade('${tier.id}')" 
                            class="w-full mt-2 py-3.5 rounded-xl bg-slate-800 text-white font-bold text-sm shadow-lg hover:bg-slate-700 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                            Start Investment <i class="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- 4. PROFIT CALCULATOR & VALIDATION ---
        function calculateProfit(id, dailyPercent, days, min, max) {
            const input = document.getElementById(`input-${id}`);
            const feedback = document.getElementById(`feedback-${id}`);
            const errorBox = document.getElementById(`error-${id}`);
            const box = document.getElementById(`box-${id}`);
            const val = parseFloat(input.value);

            // Reset Styles
            box.classList.remove('error');
            errorBox.innerHTML = '';

            if (!val || isNaN(val)) {
                feedback.innerHTML = '';
                return;
            }

            // Calculation: Always calculate profit even if error exists
            const dailyProfit = val * (dailyPercent / 100);
            const totalProfit = dailyProfit * days;
            const totalReturn = val + totalProfit;
            
            // Display Profit (Always visible)
            feedback.innerHTML = `
                <div class="flex justify-between text-slate-500">
                    <span>Daily: <span class="text-green-600">+${formatCurrency(dailyProfit)}</span></span>
                    <span>Total: <span class="text-brand-dark font-extrabold">${formatCurrency(totalReturn)}</span></span>
                </div>
            `;

            // Error Checking (Shows BELOW the profit)
            if (val < min) {
                errorBox.innerHTML = `<i class="ph-fill ph-warning-circle"></i> Min investment: ${formatCurrency(min)}`;
                box.classList.add('error');
            } else if (val > max) {
                errorBox.innerHTML = `<i class="ph-fill ph-warning-circle"></i> Max investment: ${formatCurrency(max)}`;
                box.classList.add('error');
            } else if (val > state.balance) {
                errorBox.innerHTML = `<i class="ph-fill ph-wallet"></i> Insufficient Balance`;
                box.classList.add('error');
            }
        }

        function setMax(id, max, dailyPercent, days, min) {
            const amount = Math.min(state.balance, max);
            const input = document.getElementById(`input-${id}`);
            input.value = amount;
            calculateProfit(id, dailyPercent, days, min, max);
        }

        // --- 5. START TRADE ---
        function startTrade(tierId) {
            const tier = TIERS.find(t => t.id === tierId);
            const input = document.getElementById(`input-${tierId}`);
            const amount = parseInt(input.value);

            // Validation Check
            if (!amount || amount < tier.min || amount > tier.max || amount > state.balance) {
                showToast("Please fix errors before trading.", 'error');
                document.getElementById(`box-${tierId}`).classList.add('error');
                document.getElementById(`box-${tierId}`).classList.add('animate-shake');
                setTimeout(() => document.getElementById(`box-${tierId}`).classList.remove('animate-shake'), 500);
                return;
            }

            // Execute
            state.balance -= amount;
            const durationMs = tier.days * 24 * 60 * 60 * 1000; // Days to Ms
            const now = Date.now();
            
            state.activeTrade = {
                tierId: tierId,
                amount: amount,
                startTime: now,
                endTime: now + durationMs,
                dailyPercent: tier.dailyPercent,
                days: tier.days
            };

            updateUI();
            showToast("Trade Started Successfully!", "success");
            startTimer();
        }

        // --- 6. UI SWITCHING & TIMER ---
        function updateUI() {
            document.getElementById('header-balance').innerText = formatCurrency(state.balance);

            if (state.activeTrade) {
                document.getElementById('view-market').classList.add('hidden');
                document.getElementById('view-active').classList.remove('hidden');
                
                // Stats
                const tier = TIERS.find(t => t.id === state.activeTrade.tierId);
                const totalProfit = (state.activeTrade.amount * (tier.dailyPercent / 100)) * tier.days;
                
                document.getElementById('active-invested').innerText = formatCurrency(state.activeTrade.amount);
                document.getElementById('active-return').innerText = formatCurrency(state.activeTrade.amount + totalProfit);
            } else {
                document.getElementById('view-market').classList.remove('hidden');
                document.getElementById('view-active').classList.add('hidden');
            }
        }

        function startTimer() {
            const display = document.getElementById('timer-display');
            
            const interval = setInterval(() => {
                if (!state.activeTrade) { clearInterval(interval); return; }

                const now = Date.now();
                const diff = state.activeTrade.endTime - now;

                if (diff <= 0) {
                    clearInterval(interval);
                    completeTrade();
                    return;
                }

                // Format: Days Hours Minutes
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                display.innerText = `${days}d ${hours}h ${minutes}m`;
            }, 1000);
        }

        function completeTrade() {
            const tier = TIERS.find(t => t.id === state.activeTrade.tierId);
            const totalProfit = (state.activeTrade.amount * (tier.dailyPercent / 100)) * tier.days;
            
            state.balance += (state.activeTrade.amount + totalProfit);
            state.activeTrade = null;
            
            updateUI();
            showToast(`Trade Finished! You earned ${formatCurrency(totalProfit)}`, 'success');
        }

        function showToast(msg, type) {
            const t = document.getElementById('toast');
            const color = type === 'success' ? 'success' : 'error';
            const icon = type === 'success' ? 'ph-check-circle' : 'ph-warning-circle';
            
            t.className = `toast active ${color}`;
            t.innerHTML = `<i class="ph-fill ${icon} text-lg"></i> ${msg}`;
            setTimeout(() => t.classList.remove('active'), 3000);
        }
    </script>
</body>
</html>
