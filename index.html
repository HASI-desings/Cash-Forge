<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashForge Investment Platform</title>
    
    <!-- REACT & TAILWIND LIBRARIES -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <!-- SUPABASE CLIENT -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#673AB7',
                        accent: '#3F51B5',
                        background: '#F3E5F5',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #eef2ff; 
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        #root {
            width: 100%;
            max-width: 28rem; 
            background-color: #F3E5F5;
            min-height: 100vh;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            position: relative;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pattern-dots {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 10px 10px;
        }
        /* Chatbot Animation */
        @keyframes typing {
            0% { opacity: .2; }
            20% { opacity: 1; }
            100% { opacity: .2; }
        }
        .typing-dot {
            animation: typing 1.4s infinite both;
            fill: #673AB7;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- SUPABASE CONFIGURATION ---
        const PROJECT_URL = 'https://slebhgaxbtqzroyeeipee.supabase.co';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNsZWJoZ2F4YnRxenJveWVpcGVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MDE3MTgsImV4cCI6MjA3OTI3NzcxOH0.aGveQoWEkg9NqKK7j_4zk-7iyxemmLJa8Z9-qx58xIs';
        
        // Client with session persistence disabled to fix file:// errors
        const supabase = window.supabase.createClient(PROJECT_URL, ANON_KEY, {
            auth: { persistSession: false, autoRefreshToken: false, detectSessionInUrl: false }
        });

        // Safe wrapper for background actions
        const runSafe = async (operation, fallback = null) => {
            try { return await operation(); } 
            catch (error) { console.warn("DB Error", error.message); return { error: null, data: fallback }; }
        };

        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion || { 
            motion: { div: 'div', span: 'span', button: 'button' }, 
            AnimatePresence: ({children}) => children 
        };

        // --- ICONS COMPONENT ---
        const Icon = ({ name, size = 24, className = "", ...props }) => {
            const paths = {
                Home: <><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>,
                Briefcase: <><rect width="20" height="14" x="2" y="7" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></>,
                TrendingUp: <><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></>,
                Users: <><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>,
                User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
                Bell: <><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" /><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" /></>,
                ChevronRight: <polyline points="9 18 15 12 9 6" />,
                ArrowUpRight: <><line x1="7" y1="17" x2="17" y2="7" /><polyline points="7 7 17 7 17 17" /></>,
                ArrowDownLeft: <><line x1="17" y1="7" x2="7" y2="17" /><polyline points="17 17 7 17 7 7" /></>,
                Check: <polyline points="20 6 9 17 4 12" />,
                Lock: <><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></>,
                RefreshCw: <><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></>,
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />,
                Gift: <><rect x="3" y="8" width="18" height="4" rx="1" /><path d="M12 8v13" /><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7" /><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5" /></>,
                Send: <><line x1="22" y1="2" x2="11" y2="13" /><polygon points="22 2 15 22 11 13 2 9 22 2" /></>,
                X: <><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>,
                Copy: <><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></>,
                UploadCloud: <><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M12 12v9" /><path d="m16 16-4-4-4 4" /></>,
                Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
                Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />,
                Globe: <><circle cx="12" cy="12" r="10" /><line x1="2" x2="22" y1="12" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></>,
                ShieldCheck: <><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="m9 12 2 2 4-4" /></>,
                BarChart3: <><path d="M3 3v18h18" /><path d="M18 17V9" /><path d="M13 17V5" /><path d="M8 17v-3" /></>,
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,
                Award: <><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></>,
                LogOut: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />,
                AlertCircle: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>,
                Settings: <><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></>,
                Camera: <><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></>,
                Key: <><path d="m21 2-2 2m-7.6 7.6a6 6 0 1 1-4.9-4.9L10.5 10.5 12 9l2.1 2.1 1.4-1.4 2.1 2.1 1.4-1.4 2.1 2.1z" /></>,
                Info: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></>,
                FileText: <><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><line x1="10" y1="9" x2="8" y2="9" /></>,
                MessageCircle: <><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></>
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{paths[name]}</svg>;
        };

        const convertToBase64 = (file) => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error); });

        // --- CONSTANTS ---
        const PACKAGES = [
            { id: 'basic', level: 1, name: "Basic", dailyIncome: 35, investment: 900, tasks: ["Process basic market data", "Verify transactional records"] },
            { id: 'standard', level: 2, name: "Standard", dailyIncome: 135, investment: 3900, tasks: ["Process intermediate market data", "Analyze asset performance"] },
            { id: 'advanced', level: 3, name: "Advanced", dailyIncome: 300, investment: 8900, tasks: ["Process advanced market data", "Review encrypted reports", "Execute complex algorithm"] },
            { id: 'pro', level: 4, name: "Pro", dailyIncome: 620, investment: 18500, tasks: ["High-frequency trading data", "Analyze derivative contracts", "Optimize portfolio allocation"] },
            { id: 'premium', level: 5, name: "Premium", dailyIncome: 1100, investment: 32500, tasks: ["Institutional trade data", "Deconstruct market trends", "Backtest strategies", "Verify integrity"] },
            { id: 'supreme', level: 6, name: "Supreme", dailyIncome: 2000, investment: 54900, tasks: ["Large-scale market data", "Analyze macroeconomic indicators", "Simulate hedge funds", "Review risk models"] },
            { id: 'elite', level: 7, name: "Elite", dailyIncome: 3900, investment: 112000, tasks: ["Proprietary financial data", "Geopolitical impact model", "AI-driven analysis", "Audit smart contracts", "Finalize ledger"] },
            { id: 'ultimate', level: 8, name: "Ultimate", dailyIncome: 8500, investment: 250000, tasks: ["Global market stream", "Cross-asset correlations", "Stress-test models", "Verify intl. transactions", "Dark pool liquidity", "Quantum simulation"] },
        ];
        const PROMO_DETAILS = { 1: { title: "Market Data Insights", desc: "CashForge provides real-time tracking of USDT/PKR rates. Our ecosystem has grown to over 10,000 active investors, ensuring high liquidity and stable returns." }, 2: { title: "Weekly Promotions", desc: "Earn 5% cashback on your first deposit every Monday. Invite 3 friends this week to unlock an exclusive 'Bronze Key' for the Lucky Wheel." }, 3: { title: "NFT Marketplace", desc: "Coming Soon: A fully integrated NFT marketplace where you can trade unique digital assets directly within CashForge using your accumulated balance." }, 4: { title: "CashForge Token (CFT)", desc: "The CashForge Governance Token (CFT) airdrop is approaching! Stay active and maintain a high VIP level to maximize your token allocation." } };
        const CONSTANTS = { USDT_RATE: 285, FEE_PERCENT: 0.07, WITHDRAW_PRESETS: [500, 2500, 10000, 25000, 65000, 150000, 400000, 850000], WALLETS: { TRC20: "TAjyw8fVP8dkXJjqFE3vNMBWGaNz5sRbeG", BEP20: "0x216c7d58c3F07428D3c1Be3762F402f71b43Eb56" } };
        
        // --- CHATBOT DATA ---
        const CHATBOT_CONFIG = {
          "chatbotConfig": {
            "name": "InvestmentSimCustomerCareBot",
            "description": "A rule-based AI chatbot for the Customer Care page.",
            "personality": {
              "intelligence": "Deep knowledge of all site features.",
              "politeness": "Always starts with a greeting or acknowledgment."
            },
            "fallback": {
              "message": "I'm sorry, but I may need more details or this could require personalized assistance. Please email our customer support team at support@cashforge.com with your account details and a description of the issue. We'll get back to you promptly. Is there anything else I can help with in the meantime?",
              "triggerConditions": ["unresolved issue", "user stuck", "complex account-specific problem", "after 3 attempts to clarify"]
            },
            "knowledgeBase": [
              {
                "category": "Account Initialization",
                "questions": ["How do I start?", "What happens when I first sign up?", "Initial balance"],
                "response": "Thank you for your interest! When you first access the site, your account is automatically initialized with a simulated starting balance of 10,000 PKR. This includes a default completed deposit of 10,000 PKR, total deposited set to 10,000, total wagered at 0, and you receive 1 Bronze Key, 1 Gold Key, and 1 Diamond Key for the Lucky Wheels. This setup allows you to explore features right away. If your localStorage is cleared, it resets to this state. If you're facing any issues with initialization, please try clearing your browser cache or let me know more details."
              },
              {
                "category": "Investment Packages",
                "questions": ["What are the packages?", "How to buy a package?", "Package details", "Upgrade package"],
                "response": "I'd be glad to explain the investment packages! Our site offers 8 tiered packages to simulate different investment levels:\n1. Basic: Investment 900 PKR, Daily Income 35 PKR, Tasks: Process basic market data, Verify transactional records.\n2. Standard: 3900 PKR, 135 PKR daily, Tasks: Process intermediate market data, Analyze asset performance.\n3. Advanced: 8900 PKR, 300 PKR daily, Tasks: Process advanced market data, Review encrypted financial reports, Execute complex algorithm.\n4. Pro: 18500 PKR, 620 PKR daily, Tasks: Process high-frequency trading data, Analyze derivative contracts, Optimize portfolio allocation.\n5. Premium: 32500 PKR, 1100 PKR daily, Tasks: Process institutional trade data, Deconstruct market trends, Backtest advanced strategies, Verify data integrity.\n6. Supreme: 54900 PKR, 2000 PKR daily, Tasks: Process large-scale market data, Analyze macroeconomic indicators, Simulate hedge fund operations, Review risk models.\n7. Elite: 112000 PKR, 3900 PKR daily, Tasks: Process proprietary financial data, Model geopolitical market impact, Run AI-driven portfolio analysis, Audit smart contracts, Finalize ledger entries.\n8. Ultimate: 250000 PKR, 8500 PKR daily, Tasks: Process global market data stream, Synthesize cross-asset correlations, Stress-test algorithmic models, Verify international transactions, Analyze dark pool liquidity, Execute quantum computing simulation.\nTo buy or upgrade, go to the Homepage, browse the accordion list (locked packages show as such), and select one. You'll need sufficient balance from deposits. Deducted from your userBalance. If you own a lower tier, upgrades show discounted prices. Let me know if you need help with a specific package!"
              },
              {
                "category": "Deposits",
                "questions": ["How to deposit?", "Deposit process", "USDT to PKR", "Proof of payment"],
                "response": "Happy to guide you through deposits! Deposits are a two-step process on the /deposit page:\n1. Input the amount in PKR, which converts to USDT using the rate of 285 PKR per USDT.\n2. Select a network (TRC20 or BEP20), then on /deposit/proof, you'll see the wallet address (TRC20: TAjyw8fVP8dkXJjqFE3vNMBWGaNz5sRbeG or BEP20: 0x216c7d58c3F07428D3c1Be3762F402f71b43Eb56) and a QR code. Upload a screenshot of your proof-of-payment.\nOnce verified (simulated), funds add to your balance. Minimums aren't specified, but ensure it covers package costs. If your deposit isn't reflecting, double-check the network and proof upload. If still stuck, please provide more details or email support."
              },
              {
                "category": "Withdrawals",
                "questions": ["How to withdraw?", "Withdrawal fee", "Wager lock", "Preset amounts"],
                "response": "I appreciate your patience—let's cover withdrawals politely. On the /withdraw page, view your balance and select from presets: 500, 2500, 10000, 25000, 65000, 150000, 400000, 850000 PKR. There's a 7% transaction fee, so final amount = (selected - fee). The button is disabled if total wagered < total deposited (Wager Lock—to simulate real investment commitment; explained in tooltip). Ensure you've met this by completing tasks/trades. If locked unfairly, it might be a calculation error—try resetting progress in Profile for testing. If the issue persists, email support with your balance details."
              },
              {
                "category": "Daily Tasks",
                "questions": ["How do tasks work?", "Task timers", "Claim rewards", "Weekend lock"],
                "response": "Excellent question—tasks are key to earning! On /task/[id], for your owned package, tasks appear with timers totaling 75 seconds, distributed proportionally by reward value. Buttons cycle: Start → Countdown → Claim. After all, use 'Claim All Rewards' to add to balance. Tasks are locked on weekends to simulate market closures. If a timer glitches, refresh the page or check your internet. If you can't claim, ensure all are completed. Still issues? Let me know your package level."
              },
              {
                "category": "Pro Trades",
                "questions": ["What are pro trades?", "How to trade?", "Trade limits", "Active trade rule"],
                "response": "I'm here to help with Pro Trades! On /trade, options include:\n1. Day Trading: Min 3000-Max 80000 PKR, 24-hour duration, 3% return.\n2. Weekly Booster: 15000-250000 PKR, 168 hours, 25% return.\n3. Monthly Mega: 250000-1000000 PKR, 720 hours, 350% return.\nOnly one active at a time—others disable with a countdown. Deducts from balance, adds profit after duration. If stuck starting a trade, check balance and no active ones. If countdown freezes, refresh."
              },
              {
                "category": "Lucky Wheels",
                "questions": ["How do lucky wheels work?", "Prizes", "Keys"],
                "response": "Sounds fun—let's spin into Lucky Wheels on /profile/rewards! Use your keys (start with 1 each Bronze/Gold/Diamond):\nBronze Prizes: 50, 10, 100, 20, 150, 10, 200, 30 PKR.\nGold: 300, 50, 500, 100, 750, 150, 1000, 200 PKR.\nDiamond: 1500, 500, 2500, 750, 3500, 1000, 5000, 1250 PKR.\nTabbed interface; winning triggers confetti. Earn more keys via referrals or tasks. If no spin, check key count."
              },
              {
                "category": "Affiliation and Referrals",
                "questions": ["How to build a team?", "Affiliate salaries", "VIP tiers", "Referrals"],
                "response": "Building a team is rewarding—thank you for asking! On /profile/affiliation, share your referral link (from /profile/rewards). Locked until 10 referrals, then unlock VIP tiers:\nVIP 5: 50 referrals, 12,000 PKR monthly.\nVIP 4: 180, 50,000 PKR.\nVIP 3: 300, 120,000 PKR.\nVIP 2: 500, 480,000 PKR.\nVIP 1: 1500, 1,000,000 PKR.\nProgress bar shows count. Rewards add to balance. If referrals not tracking, ensure links are used correctly."
              },
              {
                "category": "Profile and Settings",
                "questions": ["How to update profile?", "Reset progress", "Change password"],
                "response": "Your profile is your dashboard—glad to assist! On /profile, see stats, links to sub-pages, and 'Reset Progress' for testing (clears localStorage). On /profile/personal-info, use the form to update name, email, wallet, login/fund passwords (validated with react-hook-form and zod). If form errors, check inputs. Password changes require old one for security."
              },
              {
                "category": "General Issues",
                "questions": ["Site not loading", "UI problems", "Animations glitch", "Mobile issues"],
                "response": "I'm sorry you're facing issues—let's troubleshoot politely. The site is mobile-first with sticky header, expandable bottom nav (framer-motion animations), glassmorphism cards in Deep Violet (#673AB7), Light Violet background (#F3E5F5), Sky Blue accents (#3F51B5). Use 'Space Grotesk' for headlines, 'Inter' for body. If glitching, try different browser or clear cache. For large screens, content centers with max-width."
              },
              {
                "category": "Other",
                "questions": ["Anything else", "General help"],
                "response": "I'm delighted to help with any other questions! If this doesn't cover it, could you provide more details? Otherwise, for advanced support, please email our team."
              }
            ],
            "intents": {
              "greeting": "Hello! Welcome to Customer Care. How can I assist you today with our investment simulation platform?",
              "farewell": "Thank you for chatting! If you need more help, feel free to return or email support. Have a great day!"
            }
          }
        };

        // --- UI COMPONENTS ---
        const Card = ({ children, className = "", onClick }) => <div onClick={onClick} className={`glass-panel rounded-2xl shadow-sm hover:shadow-md transition-all ${className}`}>{children}</div>;
        const Button = ({ children, onClick, variant = 'primary', className = "", disabled = false }) => {
            const variants = { primary: "bg-primary text-white shadow-lg shadow-primary/30 hover:bg-violet-700", accent: "bg-accent text-white shadow-lg shadow-accent/30 hover:bg-indigo-600", secondary: "bg-white text-primary border border-violet-100 hover:bg-violet-50", outline: "border-2 border-primary/30 text-primary hover:border-primary bg-transparent", danger: "bg-red-50 text-red-500 border border-red-100" };
            return <button onClick={onClick} disabled={disabled} className={`px-4 py-3 rounded-xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 ${variants[variant]} ${disabled ? 'opacity-50 cursor-not-allowed grayscale' : ''} ${className}`}>{children}</button>;
        };
        
        // --- CHATBOT COMPONENT ---
        function ChatbotModal({ isOpen, onClose }) {
            const [messages, setMessages] = useState([{ text: CHATBOT_CONFIG.chatbotConfig.intents.greeting, sender: 'bot' }]);
            const [input, setInput] = useState("");
            const [isTyping, setIsTyping] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => {
                if (scrollRef.current) {
                    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                }
            }, [messages, isTyping]);

            const findResponse = (userInput) => {
                const lowerInput = userInput.toLowerCase();
                const kb = CHATBOT_CONFIG.chatbotConfig.knowledgeBase;
                
                // Check greetings
                if (['hi', 'hello', 'hey', 'start'].some(w => lowerInput.includes(w))) return "Hello there! How can I help you today?";
                if (['bye', 'goodbye', 'exit'].some(w => lowerInput.includes(w))) return CHATBOT_CONFIG.chatbotConfig.intents.farewell;

                // Match against knowledge base
                for (const entry of kb) {
                    // Check categories
                    if (lowerInput.includes(entry.category.toLowerCase())) return entry.response;
                    
                    // Check specific questions (keyword matching)
                    for (const q of entry.questions) {
                        const keywords = q.toLowerCase().replace('?', '').split(' ').filter(w => w.length > 3);
                        const matchCount = keywords.filter(k => lowerInput.includes(k)).length;
                        if (matchCount >= Math.min(2, keywords.length)) { // Require at least 2 keyword matches or all if short
                            return entry.response;
                        }
                    }
                }
                return CHATBOT_CONFIG.chatbotConfig.fallback.message;
            };

            const handleSend = () => {
                if (!input.trim()) return;
                
                const userMsg = { text: input, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                setIsTyping(true);

                // Simulate AI processing delay
                setTimeout(() => {
                    const responseText = findResponse(userMsg.text);
                    setMessages(prev => [...prev, { text: responseText, sender: 'bot' }]);
                    setIsTyping(false);
                }, 1500);
            };

            if (!isOpen) return null;

            return (
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 20 }} className="fixed inset-0 z-[100] bg-white flex flex-col sm:max-w-md sm:mx-auto sm:inset-auto sm:bottom-0 sm:top-20 sm:rounded-t-3xl shadow-2xl overflow-hidden">
                    <div className="bg-primary p-4 flex justify-between items-center text-white shadow-md z-10">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                                <Icon name="MessageCircle" size={24} className="text-white" />
                            </div>
                            <div>
                                <h3 className="font-bold text-lg leading-none">AI Assistant</h3>
                                <span className="text-[10px] opacity-80 flex items-center gap-1"><span className="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span> Online</span>
                            </div>
                        </div>
                        <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full transition-colors"><Icon name="X" size={24}/></button>
                    </div>
                    
                    <div className="flex-1 bg-slate-50 overflow-y-auto p-4 space-y-4" ref={scrollRef}>
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] p-3 rounded-2xl text-sm shadow-sm ${msg.sender === 'user' ? 'bg-primary text-white rounded-tr-none' : 'bg-white text-slate-700 rounded-tl-none border border-slate-100'}`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        {isTyping && (
                            <div className="flex justify-start">
                                <div className="bg-white p-3 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm flex gap-1">
                                    <div className="w-1.5 h-1.5 bg-primary rounded-full typing-dot"></div>
                                    <div className="w-1.5 h-1.5 bg-primary rounded-full typing-dot"></div>
                                    <div className="w-1.5 h-1.5 bg-primary rounded-full typing-dot"></div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="p-3 bg-white border-t border-slate-100 flex gap-2">
                        <input 
                            type="text" 
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                            placeholder="Type a message..." 
                            className="flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-2 outline-none focus:border-primary transition-colors"
                        />
                        <button onClick={handleSend} className="bg-primary text-white p-3 rounded-xl shadow-lg shadow-primary/20 active:scale-95 transition-transform">
                            <Icon name="Send" size={20} />
                        </button>
                    </div>
                </motion.div>
            );
        }

        // --- PROMO CAROUSEL (GLOBAL SCOPE) ---
        function PromoCarousel({ setPromoModal }) {
            const scrollRef = useRef(null); const [isAutoPlaying, setIsAutoPlaying] = useState(true);
            useEffect(() => { const scrollContainer = scrollRef.current; if (!scrollContainer || !isAutoPlaying) return; const scrollInterval = setInterval(() => { if (scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth - 10) { scrollContainer.scrollTo({ left: 0, behavior: 'smooth' }); } else { scrollContainer.scrollBy({ left: scrollContainer.clientWidth, behavior: 'smooth' }); } }, 3000); return () => clearInterval(scrollInterval); }, [isAutoPlaying]);
            const banners = [
                { id: 1, content: (<div className="flex flex-col items-center justify-center h-full text-center w-full px-4"><h3 className="text-xl font-bold text-white leading-tight mb-1">The Future of Crypto Investment</h3><p className="text-xs text-white/80 mb-3">Secure & Automated</p><div className="flex gap-2"><span className="bg-white/20 px-2 py-1 rounded text-[10px] font-bold text-white border border-white/20">1 USDT = ₨{CONSTANTS.USDT_RATE}</span><span className="bg-white/20 px-2 py-1 rounded text-[10px] font-bold text-white border border-white/20">10K+ Members</span></div></div>), bg: "bg-gradient-to-r from-indigo-600 to-purple-600" },
                { id: 2, content: <span className="text-2xl font-display font-bold text-white tracking-widest uppercase">Promotions</span>, bg: "bg-gradient-to-r from-pink-500 to-rose-500" },
                { id: 3, content: <span className="text-2xl font-display font-bold text-white tracking-widest uppercase">Coming</span>, bg: "bg-gradient-to-r from-amber-500 to-orange-600" },
                { id: 4, content: <span className="text-2xl font-display font-bold text-white tracking-widest uppercase">Veryyy Soon</span>, bg: "bg-gradient-to-r from-emerald-500 to-teal-600" }
            ];
            return (<div className="w-full overflow-hidden rounded-2xl shadow-lg mb-6 relative group h-40" onTouchStart={() => setIsAutoPlaying(false)} onTouchEnd={() => setIsAutoPlaying(true)} onMouseEnter={() => setIsAutoPlaying(false)} onMouseLeave={() => setIsAutoPlaying(true)}><div ref={scrollRef} className="flex w-full h-full overflow-x-auto snap-x snap-mandatory hide-scrollbar">{banners.map((b, i) => (<div key={i} className={`w-full h-full shrink-0 flex items-center justify-center ${b.bg} p-4 shadow-inner snap-center cursor-pointer`} onClick={() => setPromoModal(b.id)}>{b.content}</div>))}</div><div className="absolute bottom-3 left-0 right-0 flex justify-center gap-2">{banners.map((_, i) => (<div key={i} className="w-1.5 h-1.5 rounded-full bg-white/50" />))}</div></div>);
        }

        // --- AUTH VIEW ---
        function AuthView({ onLogin }) {
            const [isSignUp, setIsSignUp] = useState(false);
            const [formData, setFormData] = useState({ name: '', email: '', password: '', confirmPass: '' });
            const [error, setError] = useState('');
            const [showPasswordRules, setShowPasswordRules] = useState(false);
            const [isLoading, setIsLoading] = useState(false);

            const validatePassword = (pwd) => ({ length: pwd.length >= 8, upper: /[A-Z]/.test(pwd), lower: /[a-z]/.test(pwd), number: /\d/.test(pwd), special: /[!@#$%^&*(),.?":{}|<>]/.test(pwd) });
            const passRules = validatePassword(formData.password);
            const isPasswordValid = Object.values(passRules).every(Boolean);

            const handleSubmit = async () => {
                setError('');
                if (!formData.email || !formData.password) return setError("Please fill in all fields");
                if (!formData.email.toLowerCase().endsWith('@gmail.com')) return setError("Invalid Gmail");

                setIsLoading(true);
                try {
                    if (isSignUp) {
                        if (!formData.name) return setError("Name is required");
                        if (!isPasswordValid) return setError("Password does not meet security requirements");
                        if (formData.password !== formData.confirmPass) return setError("Passwords do not match");

                        const { data, error: signUpError } = await supabase.auth.signUp({ email: formData.email, password: formData.password });
                        if (signUpError) throw signUpError;
                        
                        if (data.user) {
                            const { error: profileError } = await supabase.from('profiles').insert([{ 
                                id: data.user.id, email: formData.email, name: formData.name, login_password: formData.password 
                            }]);
                            if (profileError) throw profileError;
                            alert("Account created! Please log in.");
                            setIsSignUp(false);
                        }
                    } else {
                        const { data, error: signInError } = await supabase.auth.signInWithPassword({ email: formData.email, password: formData.password });
                        if (signInError) throw signInError;
                        if (data.session) onLogin(data.session);
                    }
                } catch (err) {
                    console.error(err);
                    if (err.message.includes("Failed to fetch") || err.message.includes("Load failed")) {
                        setError("Connection Error: Please allow internet access or check Supabase dashboard.");
                    } else if (err.message.includes("Invalid login credentials")) {
                        setError("Incorrect email or password.");
                    } else {
                        setError(err.message);
                    }
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
                     <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="w-full max-w-sm relative z-10">
                        <div className="text-center mb-8"><div className="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg"><Icon name="Globe" size={32} className="text-primary" /></div><h1 className="text-3xl font-display font-bold text-primary">CashForge</h1><p className="text-slate-500">Secure Crypto Investment Platform</p></div>
                        <Card className="p-8 bg-white/80">
                            <div className="flex mb-6 bg-slate-100 p-1 rounded-xl"><button onClick={() => setIsSignUp(false)} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${!isSignUp ? 'bg-white shadow text-primary' : 'text-slate-400'}`}>Sign In</button><button onClick={() => setIsSignUp(true)} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${isSignUp ? 'bg-white shadow text-primary' : 'text-slate-400'}`}>Sign Up</button></div>
                            <div className="space-y-4">
                                {isSignUp && <div><label className="text-xs font-bold text-slate-500 uppercase ml-1">Full Name</label><input type="text" className="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none focus:border-primary transition-colors" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} placeholder="John Doe"/></div>}
                                <div><label className="text-xs font-bold text-slate-500 uppercase ml-1">Email Address</label><input type="email" className="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none focus:border-primary transition-colors" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} placeholder="name@gmail.com"/></div>
                                <div><label className="text-xs font-bold text-slate-500 uppercase ml-1">Password</label><input type="password" className="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none focus:border-primary transition-colors" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} onFocus={() => setShowPasswordRules(true)} onBlur={() => setShowPasswordRules(false)} placeholder="••••••••"/>
                                    {isSignUp && showPasswordRules && !isPasswordValid && <motion.div initial={{ opacity: 0, height: 0 }} animate={{ opacity: 1, height: 'auto' }} className="bg-slate-50 border border-slate-200 rounded-lg p-3 mt-2 text-xs text-slate-500 overflow-hidden"><p className="font-bold mb-2 text-slate-700">Security Requirements:</p><ul className="space-y-1 pl-1"><li className={`flex items-center gap-2 ${passRules.length ? 'text-emerald-600' : ''}`}><Icon name={passRules.length ? "Check" : "X"} size={10} /> Min 8 characters</li><li className={`flex items-center gap-2 ${passRules.upper ? 'text-emerald-600' : ''}`}><Icon name={passRules.upper ? "Check" : "X"} size={10} /> Uppercase Letter</li><li className={`flex items-center gap-2 ${passRules.lower ? 'text-emerald-600' : ''}`}><Icon name={passRules.lower ? "Check" : "X"} size={10} /> Lowercase Letter</li><li className={`flex items-center gap-2 ${passRules.number ? 'text-emerald-600' : ''}`}><Icon name={passRules.number ? "Check" : "X"} size={10} /> Digit (0-9)</li><li className={`flex items-center gap-2 ${passRules.special ? 'text-emerald-600' : ''}`}><Icon name={passRules.special ? "Check" : "X"} size={10} /> Special Character</li></ul></motion.div>}
                                </div>
                                {isSignUp && <div><label className="text-xs font-bold text-slate-500 uppercase ml-1">Confirm Password</label><input type="password" className="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none focus:border-primary transition-colors" value={formData.confirmPass} onChange={e => setFormData({...formData, confirmPass: e.target.value})} placeholder="••••••••"/></div>}
                            </div>
                            {error && <p className="text-red-500 text-xs font-bold mt-4 text-center animate-pulse">{error}</p>}
                            <Button onClick={handleSubmit} disabled={isLoading} className="w-full mt-6">{isLoading ? 'Processing...' : (isSignUp ? 'Create Account' : 'Access Dashboard')}</Button>
                        </Card>
                     </motion.div>
                </div>
            )
        }

        // --- MAIN APP ---
        function CashForgeApp() {
            const [view, setView] = useState('home'); 
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [notification, setNotification] = useState(null);
            const [viewParams, setViewParams] = useState(null); 
            const [modal, setModal] = useState(null); 
            const [promoModal, setPromoModal] = useState(null);

            useEffect(() => {
                const initSession = async () => {
                    const { data: { session } } = await runSafe(() => supabase.auth.getSession());
                    if (session) await fetchUserData(session.user.id);
                    setLoading(false);
                };
                initSession();
            }, []);

            const fetchUserData = async (userId) => {
                const { data: profile } = await runSafe(() => supabase.from('profiles').select('*').eq('id', userId).single());
                const { data: transactions } = await runSafe(() => supabase.from('transactions').select('*').eq('user_id', userId).order('created_at', { ascending: false }));
                
                if (profile) {
                    setUser({ 
                        id: userId,
                        isLoggedIn: true,
                        profile: { 
                            ...profile, 
                            avatar: profile.avatar, 
                            transactionPassword: profile.transaction_password, 
                            loginPassword: profile.login_password 
                        }, 
                        balance: profile.balance || 0,
                        deposited: profile.deposited || 0,
                        wagered: profile.wagered || 0,
                        transactions: transactions || [],
                        activePackageId: profile.active_package_id,
                        tasksCompletedToday: profile.tasks_completed_today || 0,
                        lastTaskDate: profile.last_task_date,
                        referrals: []
                    });
                }
            };

            const notify = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const handleLogin = (session) => {
                fetchUserData(session.user.id);
            };

            const handleLogout = async () => {
                 if(confirm("Are you sure you want to log out?")) {
                    await runSafe(() => supabase.auth.signOut());
                    setUser(null);
                    setView('home');
                 }
            };

            // --- ACTIONS ---
            const handleUpdateProfile = async (updates) => {
                setUser(prev => ({ ...prev, profile: { ...prev.profile, ...updates } }));
                notify("Profile updated successfully");
                await runSafe(() => supabase.from('profiles').update({ 
                    name: updates.name, 
                    avatar: updates.avatar, 
                    transaction_password: updates.transactionPassword,
                    login_password: updates.loginPassword
                }).eq('id', user.id));
            };

            const handleBuyPackage = async (pkg) => {
                const cost = pkg.investment; 
                if (user.balance < cost) return notify(`Insufficient Balance.`, "error");

                setModal({
                    title: `Confirm Purchase`,
                    message: `Invest ₨${cost.toLocaleString()} in ${pkg.name}?`,
                    onConfirm: async () => {
                        const newBal = user.balance - cost;
                        const newWager = user.wagered + cost;
                        
                        setUser(prev => ({ ...prev, balance: newBal, activePackageId: pkg.id, wagered: newWager }));
                        notify(`Success! You own ${pkg.name}`);
                        setModal(null);
                        setView('home');
                        
                        await runSafe(() => supabase.from('profiles').update({ balance: newBal, active_package_id: pkg.id, wagered: newWager }).eq('id', user.id));
                        await runSafe(() => supabase.from('transactions').insert({ user_id: user.id, type: 'investment', amount: cost, status: 'completed', description: `Bought ${pkg.name}` }));
                    },
                    onCancel: () => setModal(null)
                });
            };

            const handleDeposit = async (amount, method) => {
                 await runSafe(() => supabase.from('transactions').insert({ user_id: user.id, type: 'deposit', amount: parseInt(amount), status: 'pending', description: `Deposit via ${method}` }));
                 notify("Proof Uploaded. Pending Verification.");
                 setView('history');
            };

            const handleWithdraw = async (amount, txPassword) => {
                if (user.balance < amount) return notify("Insufficient Balance", "error");
                if (txPassword !== user.profile.transactionPassword) return notify("Incorrect Transaction Password", "error");

                const fee = amount * CONSTANTS.FEE_PERCENT;
                setUser(prev => ({ ...prev, balance: prev.balance - amount }));
                notify(`Withdrawal Requested`);
                setView('history');

                await runSafe(() => supabase.from('profiles').update({ balance: user.balance - amount }).eq('id', user.id));
                await runSafe(() => supabase.from('transactions').insert({ user_id: user.id, type: 'withdrawal', amount: amount, status: 'pending', description: `Withdraw (Fee: ₨${fee.toFixed(0)})` }));
            };

            const handleTaskComplete = async (reward) => {
                const newBal = user.balance + reward;
                const newCount = user.tasksCompletedToday + 1;
                setUser(prev => ({ ...prev, balance: newBal, tasksCompletedToday: newCount }));
                notify(`Task Complete! +₨${reward.toFixed(0)}`);
                await runSafe(() => supabase.from('profiles').update({ balance: newBal, tasks_completed_today: newCount, last_task_date: new Date().toISOString() }).eq('id', user.id));
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-primary font-bold animate-pulse">Loading CashForge...</div>;
            if (!user || !user.isLoggedIn) return <AuthView onLogin={handleLogin} storedProfile={user?.profile} />;

            // --- APP RENDERER ---
            const renderView = () => {
                switch(view) {
                    case 'home': return <HomeView user={user} navigate={setView} notify={notify} setPromoModal={setPromoModal} />;
                    case 'invest': return <InvestView user={user} navigate={setView} pkgId={viewParams} onBuy={handleBuyPackage} />;
                    case 'tasks': return <TaskView user={user} navigate={setView} onComplete={handleTaskComplete} />;
                    case 'trade': return <TradeView user={user} navigate={setView} />;
                    case 'deposit': return <DepositView navigate={setView} onDeposit={handleDeposit} />;
                    case 'withdraw': return <WithdrawView user={user} navigate={setView} onWithdraw={handleWithdraw} />;
                    case 'profile': return <ProfileView user={user} navigate={setView} onLogout={handleLogout} />;
                    case 'settings': return <SettingsView user={user} navigate={setView} onUpdate={handleUpdateProfile} />;
                    case 'history': return <HistoryView user={user} navigate={setView} />;
                    case 'rewards': return <RewardsView user={user} setUser={setUser} navigate={setView} />;
                    case 'affiliation': return <AffiliationView user={user} navigate={setView} />;
                    case 'support': return <SupportView navigate={setView} />;
                    default: return <HomeView user={user} navigate={setView} notify={notify} setPromoModal={setPromoModal} />;
                }
            };

            return (
                <div className="min-h-screen pb-24 relative text-slate-800 font-sans">
                    <header className="sticky top-0 z-50 bg-primary/95 backdrop-blur text-white px-4 py-3 flex justify-between items-center shadow-md">
                        <div className="flex items-center gap-2"><div className="w-8 h-8 bg-white rounded-lg flex items-center justify-center"><Icon name="Globe" size={20} className="text-primary" /></div><span className="font-display font-bold text-xl tracking-tight">CashForge</span></div>
                        <div className="flex items-center gap-3"><div className="bg-white/20 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm border border-white/30">₨ {user.balance.toLocaleString()}</div><button onClick={() => setView('support')} className="relative"><Icon name="Bell" size={22} /><span className="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-primary"></span></button></div>
                    </header>
                    <main className="p-4 relative z-10"><AnimatePresence mode="wait"><motion.div key={view} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }} transition={{ duration: 0.2 }}>{renderView()}</motion.div></AnimatePresence></main>
                    <AnimatePresence>{notification && <motion.div initial={{ y: 50, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: 50, opacity: 0 }} className={`fixed bottom-24 left-4 right-4 p-4 rounded-xl shadow-2xl z-[60] font-bold text-center text-white ${notification.type === 'error' ? 'bg-red-500' : 'bg-accent'}`}>{notification.msg}</motion.div>}</AnimatePresence>
                    <AnimatePresence>
                        {modal && (<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[70] bg-black/50 flex items-center justify-center p-6"><motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl"><h3 className="text-xl font-bold text-primary mb-2">{modal.title}</h3><p className="text-slate-600 mb-6">{modal.message}</p><div className="flex gap-3"><button onClick={modal.onCancel} className="flex-1 py-3 rounded-xl font-bold text-slate-500 bg-slate-100">Cancel</button><button onClick={modal.onConfirm} className="flex-1 py-3 rounded-xl font-bold text-white bg-primary shadow-lg shadow-primary/30">Confirm</button></div></motion.div></motion.div>)}
                        {promoModal && (<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[80] bg-black/60 flex items-center justify-center p-6 backdrop-blur-sm" onClick={() => setPromoModal(null)}><motion.div initial={{ scale: 0.9, y: 20 }} animate={{ scale: 1, y: 0 }} className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative" onClick={e => e.stopPropagation()}><button onClick={() => setPromoModal(null)} className="absolute top-4 right-4 p-2 bg-slate-100 rounded-full hover:bg-slate-200 text-slate-500"><Icon name="X" size={20}/></button><div className="mb-4"><div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary mb-4"><Icon name="Info" size={24} /></div><h3 className="text-2xl font-display font-bold text-primary mb-2">{PROMO_DETAILS[promoModal].title}</h3><p className="text-slate-600 leading-relaxed">{PROMO_DETAILS[promoModal].desc}</p></div><Button onClick={() => setPromoModal(null)} className="w-full">Got it</Button></motion.div></motion.div>)}
                    </AnimatePresence>
                    <ExpandableTabs activeTab={view} onTabChange={setView} />
                </div>
            );
        }

        // --- VIEWS ---
        function HomeView({ user, navigate, notify, setPromoModal }) {
            return (<div className="space-y-6"><PromoCarousel setPromoModal={setPromoModal} /><div className="space-y-4"><div className="flex justify-between items-center"><h2 className="text-xl font-display font-bold text-primary">Investment Tiers</h2><span className="text-xs font-bold text-accent bg-accent/10 px-2 py-1 rounded">ROI up to 3.4%</span></div>{PACKAGES.map(pkg => { const isOwned = user.activePackageId === pkg.id; const currentPkg = PACKAGES.find(p => p.id === user.activePackageId); const isHigher = currentPkg && pkg.level > currentPkg.level; const isLower = currentPkg && pkg.level < currentPkg.level; let displayPrice = pkg.investment; let label = "Purchase"; if (isOwned) label = "Active Plan"; if (isHigher) { displayPrice = pkg.investment - currentPkg.investment; label = "Upgrade"; } if (isLower && !isOwned) label = "Owned"; return (<Card key={pkg.id} onClick={() => { if (isLower) notify("You cannot downgrade to a lower tier package.", "error"); else if (isOwned) notify("You already own this active plan.", "success"); else navigate('invest', pkg.id); }} className={`relative overflow-hidden group ${isOwned ? 'border-2 border-accent' : ''} ${isLower ? 'opacity-75 grayscale-[0.5]' : ''}`}>{pkg.name === 'Ultimate' && <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 to-orange-500"></div>}<div className="p-5 flex justify-between items-center"><div><div className="flex items-center gap-2 mb-1"><h3 className="font-bold text-lg text-primary">{pkg.name}</h3>{pkg.name === 'Ultimate' && <Icon name="Star" size={14} className="text-yellow-400 fill-yellow-400" />}</div><p className="text-xs text-slate-500 font-medium">Daily: ₨ {pkg.dailyIncome}</p></div><div className="text-right"><span className="block text-xl font-display font-bold text-slate-800">₨ {displayPrice.toLocaleString()}</span><span className={`text-[10px] font-bold uppercase px-2 py-1 rounded ${isOwned ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-500'}`}>{label}</span></div></div></Card>)})}</div></div>);
        }
        function InvestView({ user, navigate, pkgId, onBuy }) {
            const pkg = PACKAGES.find(p => p.id === pkgId); if(!pkg) return null; const currentPkg = PACKAGES.find(p => p.id === user.activePackageId); let cost = pkg.investment; let isUpgrade = false; if (currentPkg && pkg.level > currentPkg.level) { cost = pkg.investment - currentPkg.investment; isUpgrade = true; } const isOwned = user.activePackageId === pkg.id; return (<div className="space-y-6 pt-4"><button onClick={() => navigate('home')} className="flex items-center text-sm text-slate-500 hover:text-primary"><Icon name="ChevronRight" className="rotate-180 mr-1" size={16}/> Back</button><Card className="p-6 text-center border-t-4 border-primary relative overflow-hidden"><div className="absolute -right-10 -top-10 w-32 h-32 bg-primary/10 rounded-full blur-2xl"></div><Icon name="Briefcase" size={48} className="mx-auto text-primary mb-4" /><h2 className="text-3xl font-display font-bold text-primary mb-1">{pkg.name} Package</h2><p className="text-slate-500 text-sm">Level {pkg.level} Investment Tier</p><div className="my-6 bg-slate-50 rounded-2xl p-4 border border-slate-200 shadow-sm text-left">{isUpgrade && (<div className="mb-4 pb-4 border-b border-slate-200 space-y-2"><div className="flex justify-between text-sm text-slate-500 font-medium"><span>Original Price</span><span className="line-through decoration-red-400 decoration-2">₨ {pkg.investment.toLocaleString()}</span></div><div className="flex justify-between text-sm text-emerald-600 font-bold bg-emerald-50 p-2 rounded-lg border border-emerald-100"><span className="flex items-center gap-1"><Icon name="TrendingUp" size={14}/> Discount Applied</span><span>- ₨ {currentPkg.investment.toLocaleString()}</span></div></div>)}<div className="flex justify-between items-center pt-1"><span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Final Price</span><span className="text-3xl font-display font-bold text-primary">₨ {cost.toLocaleString()}</span></div></div><div className="grid grid-cols-1 gap-4 mb-8"><div className="bg-white/50 p-3 rounded-xl border border-slate-100"><span className="block text-xs text-slate-500 uppercase font-bold">Daily ROI</span><span className="block text-xl font-bold text-emerald-600">₨ {pkg.dailyIncome}</span></div></div><div className="text-left space-y-3 mb-8"><h4 className="font-bold text-sm text-slate-700 uppercase">Included Protocols</h4>{pkg.tasks.map((t, i) => (<div key={i} className="flex gap-3 text-sm text-slate-600"><Icon name="Check" size={16} className="text-accent mt-0.5 shrink-0" />{t}</div>))}</div>{isOwned ? (<Button disabled className="w-full">Plan Active</Button>) : (<Button onClick={() => onBuy(pkg)} className="w-full">{isUpgrade ? `Confirm Upgrade` : `Invest Now`}</Button>)}</Card></div>);
        }
        function TaskView({ user, onComplete }) { 
            const [activeTaskIndex, setActiveTaskIndex] = useState(null); const [timeLeft, setTimeLeft] = useState(0); const pkg = PACKAGES.find(p => p.id === user.activePackageId); const isWeekend = [0, 6].includes(new Date().getDay()); const taskConfig = React.useMemo(() => { if (!pkg) return []; const totalIncome = pkg.dailyIncome; const totalTime = 75; const count = pkg.tasks.length; let weights = Array.from({ length: count }, () => Math.random()); const weightSum = weights.reduce((a, b) => a + b, 0); weights = weights.map(w => w / weightSum); return pkg.tasks.map((taskName, i) => { const isLast = i === count - 1; let reward, duration; if (isLast) { const usedReward = weights.slice(0, -1).reduce((acc, w) => acc + Math.round(w * totalIncome), 0); reward = totalIncome - usedReward; const usedTime = weights.slice(0, -1).reduce((acc, w) => acc + (w * totalTime), 0); duration = totalTime - usedTime; } else { reward = Math.round(weights[i] * totalIncome); duration = weights[i] * totalTime; } return { name: taskName, reward: reward, duration: duration }; }); }, [pkg?.id]); useEffect(() => { let interval; if (activeTaskIndex !== null && timeLeft > 0) { interval = setInterval(() => { setTimeLeft((prev) => Math.max(0, prev - 0.1)); }, 100); } else if (activeTaskIndex !== null && timeLeft <= 0) { const config = taskConfig[activeTaskIndex]; onComplete(config.reward); setActiveTaskIndex(null); } return () => clearInterval(interval); }, [activeTaskIndex, timeLeft, onComplete, taskConfig]); const handleStart = (idx) => { setActiveTaskIndex(idx); setTimeLeft(taskConfig[idx].duration); }; if (!pkg) return (<div className="text-center py-20 space-y-4"><Icon name="Lock" size={48} className="mx-auto text-slate-300"/><h3 className="font-bold text-xl text-primary">Tasks Locked</h3><p className="text-slate-500 px-8">Purchase a package to access the Quant Data Stream.</p></div>); if (isWeekend) return (<div className="text-center py-20 space-y-4"><div className="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto"><Icon name="Shield" size={32} className="text-primary"/></div><h3 className="font-bold text-xl text-primary">Market Closed</h3><p className="text-slate-500 px-8">Trading is paused on weekends. Resumes Monday.</p></div>); const tasksTotal = pkg.tasks.length; const tasksLeft = Math.max(0, tasksTotal - user.tasksCompletedToday); const earnedToday = taskConfig.slice(0, user.tasksCompletedToday).reduce((acc, t) => acc + t.reward, 0);
            return (<div className="space-y-6"><div className="bg-amber-50 border border-amber-200 rounded-xl p-3 flex items-center gap-3 shadow-sm animate-pulse"><Icon name="AlertCircle" className="text-amber-600 shrink-0" size={20} /><span className="text-xs font-bold text-amber-700">Do not leave the page until completed.</span></div><Card className="bg-gradient-to-r from-primary to-accent text-white p-6 border-none"><div className="flex justify-between items-end"><div><p className="text-violet-200 text-sm font-bold mb-1">Pending Tasks</p><h2 className="text-3xl font-display font-bold">{tasksLeft} <span className="text-lg text-violet-300">/ {tasksTotal}</span></h2></div><div className="text-right"><p className="text-violet-200 text-sm font-bold mb-1">Earned Today</p><h2 className="text-2xl font-display font-bold">+₨ {earnedToday.toFixed(0)}</h2></div></div></Card><div className="space-y-3">{taskConfig.map((task, i) => { const isDone = i < user.tasksCompletedToday; const isNext = i === user.tasksCompletedToday; const isActive = i === activeTaskIndex; const progress = isActive ? ((task.duration - timeLeft) / task.duration) * 100 : 0; return (<Card key={i} className={`p-4 ${isDone ? 'opacity-50' : ''} transition-all`}><div className="flex justify-between items-center"><div className="flex items-center gap-3"><div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${isDone ? 'bg-emerald-100 text-emerald-600' : 'bg-white text-slate-500 border'}`}>{isDone ? <Icon name="Check" size={14}/> : i+1}</div><div><p className="text-sm font-bold text-slate-700">{task.name}</p><p className="text-xs text-slate-500 font-medium">Reward: <span className="text-emerald-600">₨ {task.reward}</span></p></div></div>{!isDone && (<Button onClick={() => handleStart(i)} disabled={!isNext || activeTaskIndex !== null} className={`h-8 px-4 py-0 text-xs transition-all ${isActive ? 'w-24 bg-emerald-600 text-white shadow-emerald-200' : ''}`}>{isActive ? (<span className="font-mono font-bold">{timeLeft.toFixed(1)}s</span>) : 'Start'}</Button>)}</div>{isActive && (<div className="mt-3 h-1.5 w-full bg-slate-100 rounded-full overflow-hidden"><motion.div className="h-full bg-emerald-500" initial={{ width: 0 }} animate={{ width: `${progress}%` }} transition={{ ease: "linear", duration: 0.1 }}/></div>)}</Card>)})}</div>{tasksLeft === 0 && <div className="p-4 bg-emerald-100 text-emerald-700 rounded-xl text-center font-bold">All Daily Protocols Executed</div>}</div>);
        } 
        function TradeView() { return <div className="p-4 text-center">Trading Coming Soon</div> }
        function DepositView({ navigate, onDeposit }) { 
            const [step, setStep] = useState(1); const [amount, setAmount] = useState(''); const [net, setNet] = useState('TRC20'); const [proofFile, setProofFile] = useState(null); const [proofPreview, setProofPreview] = useState(null); const fileInputRef = useRef(null); const handleProofSelect = async (e) => { const file = e.target.files[0]; if (file) { setProofFile(file); const base64 = await convertToBase64(file); setProofPreview(base64); } };
            if (step === 1) return (<div className="space-y-6 pt-4"><button onClick={() => navigate('home')} className="text-slate-500 flex items-center text-sm"><Icon name="ChevronRight" className="rotate-180 mr-1"/> Back</button><h2 className="text-2xl font-display font-bold text-primary">Deposit Funds</h2><Card className="p-6 space-y-4"><div><label className="text-xs font-bold text-slate-500 uppercase">Amount (PKR)</label><input type="number" value={amount} onChange={e=>setAmount(e.target.value)} className="w-full p-3 bg-white border border-slate-200 rounded-xl mt-1 font-bold text-lg outline-none focus:border-primary" /></div><div className="bg-slate-50 p-3 rounded-xl flex justify-between text-sm"><span className="text-slate-500">USDT Equivalent</span><span className="font-bold text-emerald-600 font-mono">{(amount / CONSTANTS.USDT_RATE).toFixed(2)} USDT</span></div><div><label className="text-xs font-bold text-slate-500 uppercase">Network</label><div className="flex gap-2 mt-1">{['TRC20', 'BEP20'].map(n => (<button key={n} onClick={() => setNet(n)} className={`flex-1 py-2 rounded-lg font-bold text-sm border ${net === n ? 'bg-primary text-white border-primary' : 'bg-white text-slate-500'}`}>{n}</button>))}</div></div><Button onClick={() => setStep(2)} disabled={!amount} className="w-full">Next</Button></Card></div>);
            return (<div className="space-y-6 pt-4"><button onClick={() => setStep(1)} className="text-slate-500 flex items-center text-sm"><Icon name="ChevronRight" className="rotate-180 mr-1"/> Back</button><div className="text-center"><h2 className="text-xl font-bold text-primary mb-2">Scan or Copy</h2><div className="bg-white p-4 w-48 h-48 mx-auto rounded-xl border border-slate-200 flex items-center justify-center mb-4"><div className="w-full h-full bg-slate-900/10 pattern-dots rounded"></div></div><div className="bg-white p-3 rounded-xl border border-slate-200 flex items-center justify-between gap-2"><code className="text-xs text-slate-500 break-all text-left">{CONSTANTS.WALLETS[net]}</code><Icon name="Copy" size={16} className="text-primary shrink-0"/></div></div><input type="file" ref={fileInputRef} onChange={handleProofSelect} className="hidden" accept="image/*" />{proofPreview ? (<div className="relative w-full h-40 rounded-xl overflow-hidden border-2 border-dashed border-emerald-400 bg-emerald-50"><img src={proofPreview} className="w-full h-full object-cover opacity-80" /><div className="absolute inset-0 flex items-center justify-center bg-black/20"><span className="text-white font-bold text-sm flex items-center gap-2"><Icon name="Check" size={18}/> Ready to Submit</span></div><button onClick={() => { setProofPreview(null); setProofFile(null); }} className="absolute top-2 right-2 bg-white/80 p-1 rounded-full text-red-500"><Icon name="X" size={16}/></button></div>) : (<Button variant="secondary" onClick={() => fileInputRef.current.click()} className="w-full border-dashed border-2 py-8 flex-col gap-2 h-auto"><Icon name="UploadCloud" size={24} className="text-slate-400" /> <span>Upload Payment Proof</span><span className="text-xs font-normal text-slate-400">Screenshots accepted</span></Button>)}<Button onClick={() => onDeposit(amount, net)} disabled={!proofFile} className="w-full">Submit Deposit</Button></div>)
        }
        function WithdrawView({ navigate, onWithdraw }) { const [selected, setSelected] = useState(null); const [txPwdConfirm, setTxPwdConfirm] = useState(''); const [step, setStep] = useState(1); if (step === 2) return (<div className="space-y-6 pt-4"><button onClick={() => setStep(1)} className="flex items-center text-sm text-slate-500"><Icon name="ChevronRight" className="rotate-180 mr-1" size={16}/> Back</button><Card className="p-6 text-center"><div className="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4"><Icon name="Lock" size={32} className="text-primary"/></div><h3 className="font-bold text-lg mb-2">Security Check</h3><p className="text-sm text-slate-500 mb-6">Please enter your Transaction Password to confirm withdrawal of ₨{selected}.</p><input type="password" placeholder="Enter PIN (Default: 123456)" value={txPwdConfirm} onChange={e => setTxPwdConfirm(e.target.value)} className="w-full p-3 text-center text-xl tracking-widest font-bold bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-primary mb-4" /><Button onClick={() => onWithdraw(selected, txPwdConfirm)} disabled={!txPwdConfirm} className="w-full">Confirm & Withdraw</Button></Card></div>); return (<div className="space-y-6 pt-4"><button onClick={() => navigate('home')} className="text-slate-500 flex items-center text-sm"><Icon name="ChevronRight" className="rotate-180 mr-1"/> Back</button><h2 className="text-2xl font-display font-bold text-primary">Withdraw</h2><div className="grid grid-cols-3 gap-2">{CONSTANTS.WITHDRAW_PRESETS.map(amt => (<button key={amt} onClick={() => setSelected(amt)} className={`py-3 rounded-xl font-bold text-sm transition-all ${selected === amt ? 'bg-primary text-white shadow-lg' : 'bg-white text-slate-600 hover:bg-slate-50'}`}>{amt >= 1000 ? `${amt/1000}k` : amt}</button>))}</div>{selected && (<Card className="p-4 bg-white/80"><div className="flex justify-between text-sm mb-2"><span className="text-slate-500">Amount</span><span className="font-bold">₨ {selected}</span></div><div className="flex justify-between text-sm mb-2 text-red-400"><span>Fee (7%)</span><span>- ₨ {(selected * 0.07).toFixed(0)}</span></div><div className="flex justify-between font-bold text-lg pt-2 border-t text-primary"><span>Receive</span><span>₨ {(selected * 0.93).toFixed(0)}</span></div></Card>)}<Button disabled={!selected} onClick={() => setStep(2)} className="w-full">Proceed to Security</Button></div>) }
        function ProfileView({ user, navigate, onLogout }) { return (<div className="space-y-6 pt-4"><div className="flex items-center gap-4"><div className="w-16 h-16 rounded-full bg-white flex items-center justify-center text-primary shadow-md border-2 border-white overflow-hidden">{user.profile.avatar ? <img src={user.profile.avatar} className="w-full h-full object-cover" /> : <Icon name="User" size={32} />}</div><div><h2 className="font-bold text-xl text-slate-800">{user.profile.name || 'Investor'}</h2><p className="text-slate-500 text-sm">ID: CF-88291</p></div><button onClick={() => navigate('settings')} className="ml-auto bg-white p-2 rounded-xl shadow-sm border border-slate-200 text-slate-500"><Icon name="Settings" size={20}/></button></div><div className="grid grid-cols-2 gap-3"><Card className="p-4"><span className="text-xs text-slate-400 font-bold uppercase">Deposited</span><span className="block text-lg font-bold text-slate-700">₨ {user.deposited.toLocaleString()}</span></Card><Card className="p-4"><span className="text-xs text-slate-400 font-bold uppercase">Wagered</span><span className="block text-lg font-bold text-slate-700">₨ {user.wagered.toLocaleString()}</span></Card></div><div className="grid grid-cols-2 gap-3"><button onClick={() => navigate('deposit')} className="bg-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-sm border border-slate-200 hover:border-primary/30 transition-all group"><div className="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 group-hover:scale-110 transition-transform"><Icon name="ArrowDownLeft" size={20} strokeWidth={2.5} /></div><span className="font-bold text-sm text-slate-700">Deposit</span></button><button onClick={() => navigate('withdraw')} className="bg-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-sm border border-slate-200 hover:border-primary/30 transition-all group"><div className="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-500 group-hover:scale-110 transition-transform"><Icon name="ArrowUpRight" size={20} strokeWidth={2.5} /></div><span className="font-bold text-sm text-slate-700">Withdraw</span></button></div><div className="space-y-2">{[{ id: 'history', icon: 'Activity', label: 'Transactions' }, { id: 'rewards', icon: 'Gift', label: 'Rewards Center' }, { id: 'affiliation', icon: 'Users', label: 'Affiliate Program' }, { id: 'support', icon: 'ShieldCheck', label: 'Customer Care' }].map(item => (<button key={item.id} onClick={() => navigate(item.id)} className="w-full bg-white p-4 rounded-xl flex justify-between items-center shadow-sm hover:bg-slate-50"><div className="flex items-center gap-3"><Icon name={item.icon} size={20} className="text-primary" /><span className="font-bold text-slate-700">{item.label}</span></div><Icon name="ChevronRight" size={18} className="text-slate-400"/></button>))}</div><button onClick={onLogout} className="w-full py-4 text-red-500 font-bold text-sm flex items-center justify-center gap-2"><Icon name="LogOut" size={16}/> Log Out</button></div>) }
        function SettingsView({ user, navigate, onUpdate }) { const [name, setName] = useState(user.profile.name || ''); const [txPwd, setTxPwd] = useState(user.profile.transactionPassword || ''); const [loginPwd, setLoginPwd] = useState(user.profile.loginPassword || ''); const [avatarUrl, setAvatarUrl] = useState(user.profile.avatar || ''); const fileInputRef = useRef(null); const handleFileChange = async (e) => { const file = e.target.files[0]; if (file) { try { const base64 = await convertToBase64(file); setAvatarUrl(base64); } catch (err) { alert("Error reading file"); } } }; const handleSave = () => { if (!name || !txPwd) return alert("All fields required"); onUpdate({ name, transactionPassword: txPwd, loginPassword: loginPwd, avatar: avatarUrl }); navigate('profile'); }; return (<div className="space-y-6 pt-4"><button onClick={() => navigate('profile')} className="flex items-center text-sm text-slate-500 hover:text-primary"><Icon name="ChevronRight" className="rotate-180 mr-1" size={16}/> Back</button><h2 className="text-2xl font-display font-bold text-primary">Settings</h2><Card className="p-6 space-y-4"><h3 className="font-bold text-slate-700 border-b pb-2">Public Profile</h3><div className="flex flex-col items-center gap-3 mb-4"><div className="w-24 h-24 rounded-full bg-slate-200 overflow-hidden relative border-4 border-white shadow-md">{avatarUrl ? <img src={avatarUrl} className="w-full h-full object-cover" /> : <Icon name="User" className="w-10 h-10 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-400" />}</div><input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept="image/*" /><button onClick={() => fileInputRef.current.click()} className="text-xs font-bold text-accent flex items-center gap-1 bg-accent/10 px-3 py-1.5 rounded-full hover:bg-accent/20 transition-colors"><Icon name="Camera" size={14}/> Change Photo</button></div><div><label className="text-xs font-bold text-slate-500 uppercase">Username</label><input value={name} onChange={e => setName(e.target.value)} className="w-full p-3 bg-slate-50 rounded-xl mt-1 outline-none border border-slate-200 focus:border-primary" /></div></Card><Card className="p-6 space-y-4"><h3 className="font-bold text-slate-700 border-b pb-2 flex items-center gap-2"><Icon name="Key" size={18} /> Security</h3><div><label className="text-xs font-bold text-slate-500 uppercase">Transaction Password</label><input type="text" value={txPwd} onChange={e => setTxPwd(e.target.value)} className="w-full p-3 bg-slate-50 rounded-xl mt-1 outline-none border border-slate-200 focus:border-primary" /><p className="text-[10px] text-slate-400 mt-1">Required for all withdrawals.</p></div><div><label className="text-xs font-bold text-slate-500 uppercase">Login Password</label><input type="text" value={loginPwd} onChange={e => setLoginPwd(e.target.value)} className="w-full p-3 bg-slate-50 rounded-xl mt-1 outline-none border border-slate-200 focus:border-primary" /></div></Card><Button onClick={handleSave} className="w-full">Save Changes</Button></div>) }
        function HistoryView({ user, navigate }) { return (<div className="space-y-4 pt-4"><button onClick={() => navigate('profile')} className="text-slate-500 flex items-center text-sm"><Icon name="ChevronRight" className="rotate-180 mr-1"/> Back</button><h2 className="text-2xl font-display font-bold text-primary">History</h2>{user.transactions.length === 0 ? <div className="text-center text-slate-400 py-10">No Transactions Yet</div> : user.transactions.map(tx => <Card key={tx.id} className="p-4 flex justify-between items-center"><div><p className="font-bold text-sm capitalize text-slate-700">{tx.type}</p><p className="text-xs text-slate-400">{new Date(tx.date).toLocaleDateString()}</p></div><div className="text-right"><span className={`block font-bold ${tx.type === 'deposit' || tx.type.includes('return') ? 'text-emerald-600' : 'text-slate-600'}`}>{tx.type === 'withdrawal' || tx.type === 'investment' ? '-' : '+'} ₨ {tx.amount}</span><span className="text-[10px] uppercase font-bold text-accent">{tx.status}</span></div></Card>)}</div>) }
        function RewardsView() { return <div>Rewards</div> }
        function AffiliationView({ user }) { return <div className="p-4">Referrals: {user.referrals.length}</div> }
        function SupportView({ navigate }) { 
            const [chatOpen, setChatOpen] = useState(false);
            return (
                <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 pt-4">
                     <button onClick={() => navigate('profile')} className="text-slate-500 flex items-center text-sm"><Icon name="ChevronRight" className="rotate-180 mr-1"/> Back</button>
                    <h2 className="text-2xl font-display font-bold text-primary">Customer Care</h2>
                    
                    <div className="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-40 h-40 bg-primary/5 rounded-full -mr-10 -mt-10"></div>
                        <div className="relative z-10">
                             <h3 className="font-bold text-lg text-slate-800 mb-2">Need Assistance?</h3>
                             <p className="text-slate-500 text-sm mb-6">Our AI assistant can help you with common questions about deposits, withdrawals, and packages instantly.</p>
                             
                             <button 
                                onClick={() => setChatOpen(true)}
                                className="w-full bg-gradient-to-r from-primary to-accent hover:from-accent hover:to-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-primary/20 flex items-center justify-center gap-3 transition-all active:scale-95"
                             >
                                <Icon name="MessageCircle" size={20} />
                                Start Live Chat
                             </button>
                        </div>
                    </div>

                    <div className="space-y-3">
                        <p className="text-xs font-bold text-slate-400 uppercase ml-2">Other Channels</p>
                        <a href="#" className="flex items-center gap-4 bg-white p-4 rounded-xl border border-slate-100 hover:border-primary/30 transition-colors shadow-sm">
                            <div className="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                                <Icon name="MessageCircle" size={20} />
                            </div>
                            <div>
                                <div className="font-bold text-slate-700">WhatsApp Support</div>
                                <div className="text-xs text-slate-400">Average wait: 15 mins</div>
                            </div>
                            <Icon name="ChevronRight" className="ml-auto text-slate-300" size={18} />
                        </a>
                         <a href="#" className="flex items-center gap-4 bg-white p-4 rounded-xl border border-slate-100 hover:border-primary/30 transition-colors shadow-sm">
                            <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                                <Icon name="Shield" size={20} />
                            </div>
                            <div>
                                <div className="font-bold text-slate-700">Official Channel</div>
                                <div className="text-xs text-slate-400">Join for updates</div>
                            </div>
                            <Icon name="ChevronRight" className="ml-auto text-slate-300" size={18} />
                        </a>
                    </div>

                    <ChatbotModal isOpen={chatOpen} onClose={() => setChatOpen(false)} />
                </div>
            );
        }
        
        function ExpandableTabs({ activeTab, onTabChange }) { return <div className="fixed bottom-0 w-full bg-white p-4 flex justify-around"><button onClick={() => onTabChange('home')}>Home</button><button onClick={() => onTabChange('profile')}>Profile</button></div> }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CashForgeApp />);
    </script>
</body>
</html>